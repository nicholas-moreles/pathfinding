goog.require("goog.structs.PriorityQueue");var STR_COST=10;var DIAG_COST=14;var CELL_SIZE=16;var WIDTH;var HEIGHT;var OFFSET_STR_SMALL=2;var OFFSET_STR_LARGE=14;var OFFSET_DIAG_SMALL=8.5;var OFFSET_DIAG_LARGE=7.5;var NO_WALLS=[];var Colors=Object.freeze({HERO:"#cf5300",GOAL:"green",WALL:"grey",CANVAS:"white"});var Speed=Object.freeze({SLOW:[200,280],NORMAL:[150,210],FAST:[100,140]});var Selected=Object.freeze({DIAG:0,SLOW_SPEED:1,NORMAL_SPEED:2,FAST_SPEED:3,ADD_WALLS:4,REMOVE_WALLS:5,MOVE_HERO:6,MOVE_GOAL:7});var KeyCodes=Object.freeze({RESET:13,TOGGLE:32,DIAG:68,SLOW_SPEED:83,NORMAL_SPEED:78,FAST_SPEED:70,ADD_WALLS:65,REMOVE_WALLS:82,MOVE_HERO:72,MOVE_GOAL:71});var Map=Object.freeze({RANDOM:1,SPIRAL:2,EMPTY:3});function Hero(a,b){this.x=a;this.y=b;this.drawX=a*CELL_SIZE;this.drawY=b*CELL_SIZE}function Position(a,b){this.x=a;this.y=b}function Node(a,d,c,b){this.x=a;this.y=d;this.cost=c;this.parent=b}Node.prototype.getChildren=function(b,e,i){var a=[];for(var d=-1;d<=1;++d){for(var c=-1;c<=1;++c){if(i||d===0||c===0){var h=this.x+d;var g=this.y+c;if(isValidChild(h,g,b,e)){var f=this.cost+(d===0||c===0?STR_COST:DIAG_COST);a.push(new Node(h,g,f,this))}}}}return a};function inBounds(a,b){return a>=0&&a<WIDTH&&b>=0&&b<HEIGHT}function inBoundsAndNotWall(a,c,b){return inBounds(a,c)&&!b[c][a]}function isValidChild(a,d,c,b){return inBoundsAndNotWall(a,d,c)&&!b[d][a]}function mdHeuristic(d,c){return(Math.abs(d.x-c.x)+Math.abs(d.y-c.y))*STR_COST}function dsHeuristic(e,d){var c=Math.abs(e.x-d.x);var f=Math.abs(e.y-d.y);return(c>f?(DIAG_COST*f+STR_COST*(c-f)):(DIAG_COST*c+STR_COST*(f-c)))}function aStar(p,n,d,s){var r=[];if(p.x===n.x&&p.y===n.y){return r}var l=[];for(var m=0;m<HEIGHT;++m){var q=[];for(var o=0;o<WIDTH;++o){q.push(false)}l.push(q)}var j=s?dsHeuristic:mdHeuristic;var g=new goog.structs.PriorityQueue();g.enqueue(0,new Node(p.x,p.y,0,null));while(!g.isEmpty()){var f=g.dequeue();if(!l[f.y][f.x]){l[f.y][f.x]=true;if(f.x===n.x&&f.y===n.y){var e=0;while(f.parent!==null){r.push(new Position(f.x,f.y));f=f.parent}return r}var c=f.getChildren(d,l,s);for(var e=0;e<c.length;++e){var k=c[e];var h=k.cost+j(k,n);g.enqueue(h,k)}}}return r}function getMapFromFile(b){var a=[];$.ajax({type:"GET",url:"maps/"+b,async:false,success:function(e){var d=e.split("\n");for(var g=0;g<d.length;++g){var f=[];for(var c=0;c<d[g].length;++c){f.push(d[g].charAt(c)==="-")}a.push(f)}},error:function(){console.log("error")}});return a}function getRandomMap(){var b=[];for(var d=0;d<HEIGHT;++d){var c=[];for(var a=0;a<WIDTH;++a){c.push(false)}b.push(c)}recursiveDivision(0,WIDTH-1,0,HEIGHT-1,b);return b}function recursiveDivision(q,p,d,c,s){var n=p-q;var l=c-d;if(n>1&&l>1){var r=n===l?Math.random()<0.5:l>n;var e=r?n:l;var b=r?q:getRandomInt(q+1,p-1);var a=r?getRandomInt(d+1,c-1):d;var g=b;var f=a;var j=r?1:0;var h=r?0:1;var m=r?getRandomInt(q,p):g;var k=r?f:getRandomInt(d,c);for(var o=0;o<=e;++o){s[f][g]=!(m===g&&k===f);g+=j;f+=h}if(r){recursiveDivision(q,p,d,a-1,s);recursiveDivision(q,p,a+1,c,s);if(inBounds(m,k-1)){s[k-1][m]=false}if(inBounds(m,k+1)){s[k+1][m]=false}}else{recursiveDivision(q,b-1,d,c,s);recursiveDivision(b+1,p,d,c,s);if(inBounds(m-1,k)){s[k][m-1]=false}if(inBounds(m+1,k)){s[k][m+1]=false}}}}function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b};
